# Example configuration illustrating non-IID stream selection for Mosaic dataloaders.
# The values are placeholders to demonstrate structure only.

[model]
name = "mosaic_llama3_mup"
flavor = "16M"

[training]
local_batch_size = 2
seq_len = 2048
steps = 1

[mosaic_dataloader]
name = "text"
drop_last = true

[mosaic_dataloader.dataset]
max_seq_len = 2048
shuffle = false

# Sequential shorthand: entries without explicit rank metadata map to dp_rank
# according to their order in the array.
[[mosaic_dataloader.dataset.non_iid.sequence]]
  [mosaic_dataloader.dataset.non_iid.sequence.streams.train]
  remote = "s3://example-bucket/datasets/client0/train"
  local = "/datasets/client0/train"

  [mosaic_dataloader.dataset.non_iid.sequence.client_streams.client_0]
  remote = "s3://example-bucket/datasets/client0/cache"
  local = "/datasets/client0/cache"

[[mosaic_dataloader.dataset.non_iid.sequence]]
  [mosaic_dataloader.dataset.non_iid.sequence.streams.train]
  remote = "s3://example-bucket/datasets/client1/train"
  local = "/datasets/client1/train"

  [mosaic_dataloader.dataset.non_iid.sequence.client_streams.client_1]
  remote = "s3://example-bucket/datasets/client1/cache"
  local = "/datasets/client1/cache"

# Keyed override: rank 2 gets its own definition, taking precedence over the
# sequential entry at index 2.
[mosaic_dataloader.dataset.non_iid.by_dp_rank."2".streams.train]
remote = "s3://example-bucket/datasets/client2/train"
local = "/datasets/client2/train"

[mosaic_dataloader.dataset.non_iid.by_dp_rank."2".client_streams.client_2]
remote = "s3://example-bucket/datasets/client2/cache"
local = "/datasets/client2/cache"
